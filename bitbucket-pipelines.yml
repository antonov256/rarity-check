#  Template Java Gradle build

#  This template allows you to test and build your Java project with Gradle.
#  The workflow allows running tests, code checkstyle and security scans on the default branch.

# Prerequisites: appropriate project structure should exist in the repository.

image: gradle:6.6.0

pipelines:
  default:
    - parallel:
      - step:
          name: Build and Test
          caches:
            - gradle
          script:
            - gradle build
      - step:
          name: Deploy to staging
          deployment: staging
          script:
            - pipe: atlassian/aws-elasticbeanstalk-deploy:0.7.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY
                AWS_DEFAULT_REGION: "eu-central-1"
                APPLICATION_NAME: "RarityCheck"
                COMMAND: 'deploy-only'
                ENVIRONMENT_NAME: "Raritycheck-staging"
                APPLICATION_NAME: "raritycheck.jar"
                S3_BUCKET: 'elasticbeanstalk-eu-central-1-916378583184'
      - step:
          name: Deploy to prod
          deployment: production
          trigger: manual
          script:
            - echo "This step runs once you click the 'Run' button"
